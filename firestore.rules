rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // Allow any logged-in user to read the dashboard_users collection
    // to check if they are authorized.
    match /dashboard_users/{document} {
      // Allow read/write ONLY if the user is authenticated AND their email exists as a document in this collection
      // This effectively restricts access to the "allowed list" of users.
      allow read, write: if request.auth != null && exists(/databases/$(database)/documents/dashboard_users/$(request.auth.token.email));
    }
  }
}
